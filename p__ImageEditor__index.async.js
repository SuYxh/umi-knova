"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[572],{42074:function(Re,V,d){d.r(V),d.d(V,{default:function(){return be}});var _=d(15558),K=d.n(_),ee=d(48305),x=d.n(ee),r=d(93236),M=d(53531),te=d(1463),e=d(62086),ne=function(n){var a=n.defaultColor,i=n.onColorSelected,v=(0,r.useState)(a||"#ff483c"),c=x()(v,2),l=c[0],C=c[1],y=(0,r.useState)(!1),b=x()(y,2),u=b[0],h=b[1],s=function(){h(!u)},S=function(){h(!1)},k=function(E){C(E.hex),i(E.hex),S()};return(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{style:{padding:"5px",background:l,borderRadius:"2px",boxShadow:"0 0 0 1px rgba(0,0,0,.1)",display:"inline-block",cursor:"pointer"},onClick:s,children:(0,e.jsx)("div",{style:{width:"36px",height:"14px",borderRadius:"2px",background:l}})}),u?(0,e.jsxs)("div",{style:{position:"absolute",zIndex:"2"},children:[(0,e.jsx)("div",{style:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"},onClick:S}),(0,e.jsx)(te.xS,{color:l,onChangeComplete:k})]}):null]})},ae=ne,oe=function(n){var a=n.lines,i=n.eraserEnabled,v=n.eraserPosition;return(0,e.jsxs)(M.mh,{children:[a.map(function(c,l){return(0,e.jsx)(M.x1,{points:c.points,stroke:c.tool==="eraser"?"white":"black",strokeWidth:5,tension:.5,lineCap:"round",globalCompositeOperation:c.tool==="eraser"?"destination-out":"source-over"},l)}),i&&(0,e.jsx)(M.Cd,{x:v.x,y:v.y,radius:10,fill:"red"})]})},re=oe,se=d(26068),D=d.n(se),ie=d(67825),le=d.n(ie),ue=d(97629),ce=d.n(ue),de=["src","stageWidth","stageHeight","rotation","setImgRef"],he=function(n){var a=n.src,i=n.stageWidth,v=n.stageHeight,c=n.rotation,l=n.setImgRef,C=le()(n,de),y=ce()(a,"anonymous"),b=x()(y,1),u=b[0],h=(0,r.useRef)(null),s=(0,r.useState)({width:0,height:0,x:0,y:0}),S=x()(s,2),k=S[0],P=S[1];return(0,r.useEffect)(function(){if(u){var E=Math.min(i,v),j=Math.max(u.width,u.height),m=E/j*.8,F=u.width*m,B=u.height*m;P({width:F,height:B,x:i/2,y:v/2})}l(h.current)},[u,i,v,l]),(0,e.jsx)(M.Ee,D()(D()({ref:h,image:u,rotation:c,offsetX:k.width/2,offsetY:k.height/2},k),C))},ge=he,ve=function(n){var a=n.shapeProps,i=n.isSelected,v=n.onSelect,c=n.onChange,l=n.shapeType,C=r.useRef(),y=r.useRef();r.useEffect(function(){i&&(y.current.nodes([C.current]),y.current.getLayer().batchDraw())},[i]);var b=l==="rect"?M.UL:l==="ellipse"?M.Pj:M.Eh;return(0,e.jsxs)(r.Fragment,{children:[(0,e.jsx)(b,D()(D()({onClick:v,onTap:v,ref:C},a),{},{draggable:!0,onDragEnd:function(h){c(D()(D()({},a),{},{x:h.target.x(),y:h.target.y()}))},onTransformEnd:function(h){var s=C.current,S=s.scaleX(),k=s.scaleY();if(s.scaleX(1),s.scaleY(1),l==="arrow"){var P=s.points(),E=P.map(function(j,m){return m%2===0?j*S:j*k});c(D()(D()({},a),{},{points:E}))}else c(D()(D()({},a),{},{x:s.x(),y:s.y(),width:s.width()*S,height:s.height()*k}))}})),i&&(0,e.jsx)(M.$T,{ref:y,flipEnabled:!1,boundBoxFunc:function(h,s){return Math.abs(s.width)<5||Math.abs(s.height)<5?h:s}})]})},pe=ve;function fe(){var W=(0,r.useState)([]),n=x()(W,2),a=n[0],i=n[1],v=(0,r.useState)(!1),c=x()(v,2),l=c[0],C=c[1],y=(0,r.useState)(!1),b=x()(y,2),u=b[0],h=b[1],s=(0,r.useState)({x:0,y:0}),S=x()(s,2),k=S[0],P=S[1],E=(0,r.useState)(!1),j=x()(E,2),m=j[0],F=j[1],B=function(g){var p=g.target.checked;p||h(!1),F(p)},R=function(g){i([].concat(K()(a),[{points:[g.x,g.y],tool:u?"eraser":"brush"}]))},Y=function(g){var p=a[a.length-1];p.points=[].concat(K()(p.points),[g.x,g.y]);var w=a.slice();w.splice(a.length-1,1,p),i(w)},L=function(g){var p=10,w=a.filter(function(X){return X.points.every(function($,z){return z%2===0?Math.hypot($-g.x,X.points[z+1]-g.y)>p:!0})});i(w)},N=function(){if(!m){alert("\u8BF7\u9009\u4E2D\u753B\u7B14");return}h(!u)},H=function(g){if(m){C(!0);var p=g.target.getStage(),w=p.getPointerPosition();R(w)}},O=function(g){if(m){var p=g.target.getStage(),w=p.getPointerPosition();P(w),l&&Y(w),u&&!l&&L(w)}},G=function(){C(!1)};return{lines:a,isDrawing:l,eraserEnabled:u,eraserPosition:k,isSelectPen:m,toggleEraser:N,handleCheckboxChange:B,handleMouseMoveLine:O,handleMouseDownLine:H,handleMouseUpLine:G}}var xe=fe,Se=[{x:200,y:300,width:100,height:100,fill:"red",id:"rect1",type:"rect"},{x:150,y:150,radiusX:50,radiusY:25,stroke:"black",strokeWidth:2,id:"ellipse1",type:"ellipse"},{x:300,y:100,width:150,height:75,stroke:"blue",strokeWidth:2,id:"rect2",type:"rect"},{points:[250,100,350,200],pointerLength:10,pointerWidth:10,fill:"black",stroke:"black",strokeWidth:4,id:"arrow1",type:"arrow"}],T={"operation-area":"operation-area___hPPAe","operation-image":"operation-image___x23X4","operation-pen":"operation-pen___BYShq","operation-line":"operation-line___L4lcy","operation-color":"operation-color___YPiTH","operation-btn":"operation-btn___eTeGw"},me=function(n){var a=n.stageWidth,i=n.stageHeight,v=n.src,c=(0,r.useRef)(null),l=(0,r.useRef)(null),C=(0,r.useState)(0),y=x()(C,2),b=y[0],u=y[1],h=(0,r.useState)(5),s=x()(h,2),S=s[0],k=s[1],P=(0,r.useState)(Se),E=x()(P,2),j=E[0],m=E[1],F=(0,r.useState)(null),B=x()(F,2),R=B[0],Y=B[1];(0,r.useEffect)(function(){console.log("selectedId change",R)},[R]);var L=xe(),N=L.lines,H=L.eraserEnabled,O=L.eraserPosition,G=L.isSelectPen,I=L.toggleEraser,g=L.handleCheckboxChange,p=L.handleMouseDownLine,w=L.handleMouseMoveLine,X=L.handleMouseUpLine,$=function(t){c.current=t},z=function(){if(c.current&&l.current){var t=c.current,f=t.scaleX(),Q=t.scaleY(),A=t.width()*f,q=t.height()*Q,De=t.x()-A/2,Pe=t.y()-q/2,Ie=l.current.toDataURL({x:De,y:Pe,width:A,height:q,pixelRatio:2}),U=document.createElement("a");U.download="cropped-image.png",U.href=Ie,document.body.appendChild(U),U.click(),document.body.removeChild(U)}},Z=function(t){var f=t.target===t.target.getStage();f&&Y(null)},ke=function(t){console.log("onColorSelected",t)},je=function(){console.log("\u5F53\u524D\u9009\u4E2D\u7684\u56FE\u5F62",R);var t=j.filter(function(f){return f.id!==R});m(t)},J=function(t){var f={};switch(t){case"rect":f={x:300,y:100,width:150,height:75,stroke:"blue",strokeWidth:2,id:"rect2",type:"rect"};break;case"ellipse":f={x:150,y:150,radiusX:50,radiusY:25,stroke:"black",strokeWidth:2,id:"ellipse1",type:"ellipse"};break;case"arrow":f={points:[250,100,350,200],pointerLength:10,pointerWidth:10,fill:"black",stroke:"black",strokeWidth:4,id:"arrow1",type:"arrow"};break;default:break}m([].concat(K()(j),[f]))},we=function(t){console.log("handleMouseDown",t),w(t)},Ee=function(t){console.log("handleMouseDown",t),p(t),Z(t)},Le=function(t){console.log("handleMouseUp",t),X()},Me=function(t){console.log("handleTouchStart",t),Z(t)};return(0,r.useEffect)(function(){var o=function(f){f.key==="Backspace"&&(console.log("\u9000\u683C\u952E\u88AB\u6309\u4E0B\u4E86"),je())};return document.addEventListener("keydown",o),function(){document.removeEventListener("keydown",o)}},[R]),(0,e.jsxs)("div",{style:{width:a+"px",height:"auto",border:"1px solid black"},children:[(0,e.jsxs)("div",{className:T["operation-area"],children:[(0,e.jsxs)("div",{className:T["operation-image"],children:[(0,e.jsx)("span",{children:"\u56FE\u7247\u65CB\u8F6C:"}),(0,e.jsx)("input",{type:"range",min:"0",max:"360",value:b,onChange:function(t){return u(Number(t.target.value))},style:{marginBottom:"10px"}}),(0,e.jsx)("button",{type:"button",onClick:z,style:{marginLeft:"10px"},children:"\u5BFC\u51FA\u56FE\u7247"})]}),(0,e.jsxs)("div",{className:T["operation-pen"],children:[(0,e.jsxs)("label",{children:[(0,e.jsx)("input",{type:"checkbox",checked:G,onChange:g}),"\u5F00\u59CB\u7ED8\u753B"]}),(0,e.jsx)("button",{type:"button",onClick:I,style:{marginLeft:"10px"},children:H?"Switch to Brush":"Switch to Eraser"})]}),(0,e.jsxs)("div",{className:T["operation-line"],children:[(0,e.jsx)("span",{children:"\u7EBF\u6761\u7C97\u7EC6:"}),(0,e.jsx)("input",{type:"range",min:"0",max:"100",value:S,onChange:function(t){return k(Number(t.target.value))},style:{marginBottom:"10px"}})]}),(0,e.jsxs)("div",{className:T["operation-color"],children:[(0,e.jsx)("span",{children:"\u9009\u62E9\u989C\u8272:"}),(0,e.jsx)(ae,{onColorSelected:ke})]}),(0,e.jsxs)("div",{className:T["operation-btn"],children:[(0,e.jsx)("button",{type:"button",onClick:function(){return J("rect")},children:"\u6DFB\u52A0\u77E9\u5F62"}),(0,e.jsx)("button",{type:"button",onClick:function(){return J("ellipse")},children:"\u6DFB\u52A0\u692D\u5706"}),(0,e.jsx)("button",{type:"button",onClick:function(){return J("arrow")},children:"\u6DFB\u52A0\u7BAD\u5934"})]})]}),(0,e.jsxs)(M.Hf,{ref:l,width:a,height:i,onMousemove:we,onMouseDown:Ee,onMouseup:Le,onTouchStart:Me,children:[(0,e.jsxs)(M.mh,{children:[(0,e.jsx)(ge,{src:v,stageWidth:a,stageHeight:i,rotation:b,setImgRef:$}),j.map(function(o,t){return(0,e.jsx)(pe,{shapeProps:o,isSelected:o.id===R,onSelect:function(){console.log("Shape-onSelect",o.id),Y(o.id)},onChange:function(Q){var A=j.slice();A[t]=Q,m(A)},shapeType:o.type},t)})]}),(0,e.jsx)(re,{lines:N,eraserEnabled:H,eraserPosition:O})]})]})},Ce=me,ye=function(){var n="https://qn.huat.xyz/mac/202406051057150.jpeg",a=700,i=500;return(0,e.jsx)("div",{children:(0,e.jsx)(Ce,{stageWidth:a,stageHeight:i,src:n})})},be=ye}}]);
