(self.webpackChunk=self.webpackChunk||[]).push([[572],{43356:function(q,V,o){"use strict";o.r(V),o.d(V,{default:function(){return le}});var R=o(48305),x=o.n(R),t=o(93236),u=o(53531),T=o(26068),c=o.n(T),U=o(67825),_=o.n(U),B=o(97629),z=o.n(B),n=o(62086),K=["src","stageWidth","stageHeight","rotation","setImgRef"],y=function(a){var r=a.src,d=a.stageWidth,M=a.stageHeight,v=a.rotation,g=a.setImgRef,E=_()(a,K),L=z()(r,"anonymous"),j=x()(L,1),i=j[0],f=(0,t.useRef)(null),s=(0,t.useState)({width:0,height:0,x:0,y:0}),S=x()(s,2),w=S[0],W=S[1];return(0,t.useEffect)(function(){if(i){var C=Math.min(d,M),D=Math.max(i.width,i.height),I=C/D*.8,H=i.width*I,F=i.height*I;W({width:H,height:F,x:d/2,y:M/2})}g(f.current)},[i,d,M,g]),(0,n.jsx)(u.Ee,c()(c()({ref:f,image:i,rotation:v,offsetX:w.width/2,offsetY:w.height/2},w),E))},$=y,G=function(a){var r=a.shapeProps,d=a.isSelected,M=a.onSelect,v=a.onChange,g=a.shapeType,E=t.useRef(),L=t.useRef();t.useEffect(function(){d&&(L.current.nodes([E.current]),L.current.getLayer().batchDraw())},[d]);var j=g==="rect"?u.UL:g==="ellipse"?u.Pj:u.Eh;return(0,n.jsxs)(t.Fragment,{children:[(0,n.jsx)(j,c()(c()({onClick:M,onTap:M,ref:E},r),{},{draggable:!0,onDragEnd:function(f){v(c()(c()({},r),{},{x:f.target.x(),y:f.target.y()}))},onTransformEnd:function(f){var s=E.current,S=s.scaleX(),w=s.scaleY();if(s.scaleX(1),s.scaleY(1),g==="arrow"){var W=s.points(),C=W.map(function(D,I){return I%2===0?D*S:D*w});v(c()(c()({},r),{},{points:C}))}else v(c()(c()({},r),{},{x:s.x(),y:s.y(),width:s.width()*S,height:s.height()*w}))}})),d&&(0,n.jsx)(u.$T,{ref:L,flipEnabled:!1,boundBoxFunc:function(f,s){return Math.abs(s.width)<5||Math.abs(s.height)<5?f:s}})]})},ee=G,ae=o(15558),te=o.n(ae);function re(){var k=(0,t.useState)([]),a=x()(k,2),r=a[0],d=a[1],M=(0,t.useState)(!1),v=x()(M,2),g=v[0],E=v[1],L=(0,t.useState)(!1),j=x()(L,2),i=j[0],f=j[1],s=(0,t.useState)({x:0,y:0}),S=x()(s,2),w=S[0],W=S[1],C=function(h){d([].concat(te()(r),[{points:[h.x,h.y],tool:i?"eraser":"brush"}]))},D=function(h){var p=r[r.length-1];p.points=[].concat(te()(p.points),[h.x,h.y]);var m=r.slice();m.splice(r.length-1,1,p),d(m)},I=function(h){var p=10,m=r.filter(function(O){return O.points.every(function(Z,Q){return Q%2===0?Math.hypot(Z-h.x,O.points[Q+1]-h.y)>p:!0})});d(m)},H=function(){f(!i)},F=function(h){E(!0);var p=h.target.getStage(),m=p.getPointerPosition();C(m)},J=function(h){var p=h.target.getStage(),m=p.getPointerPosition();W(m),g&&D(m),i&&!g&&I(m)},b=function(){E(!1)};return{lines:r,isDrawing:g,eraserEnabled:i,eraserPosition:w,toggleEraser:H,handleMouseMoveLine:J,handleMouseDownLine:F,handleMouseUpLine:b}}var se=re,oe=[{x:10,y:10,width:100,height:100,fill:"red",id:"rect1",type:"rect"},{x:150,y:150,radiusX:50,radiusY:25,stroke:"black",strokeWidth:2,id:"ellipse1",type:"ellipse"},{x:300,y:100,width:150,height:75,stroke:"blue",strokeWidth:2,id:"rect2",type:"rect"},{points:[250,100,350,200],pointerLength:10,pointerWidth:10,fill:"black",stroke:"black",strokeWidth:4,id:"arrow1",type:"arrow"}],ie=function(a){var r=a.stageWidth,d=a.stageHeight,M=a.src,v=(0,t.useRef)(null),g=(0,t.useRef)(null),E=(0,t.useState)(0),L=x()(E,2),j=L[0],i=L[1],f=(0,t.useState)(oe),s=x()(f,2),S=s[0],w=s[1],W=(0,t.useState)(null),C=x()(W,2),D=C[0],I=C[1],H=function(e){v.current=e},F=function(){if(v.current&&g.current){var e=v.current,X=e.scaleX(),N=e.scaleY(),Y=e.width()*X,ne=e.height()*N,fe=e.x()-Y/2,pe=e.y()-ne/2,me=g.current.toDataURL({x:fe,y:pe,width:Y,height:ne,pixelRatio:2}),A=document.createElement("a");A.download="cropped-image.png",A.href=me,document.body.appendChild(A),A.click(),document.body.removeChild(A)}},J=function(e){var X=e.target===e.target.getStage();X&&I(null)},b=se(),P=b.lines,h=b.eraserEnabled,p=b.eraserPosition,m=b.toggleEraser,O=b.handleMouseDownLine,Z=b.handleMouseMoveLine,Q=b.handleMouseUpLine,ce=function(e){console.log("handleMouseDown",e),Z(e)},he=function(e){console.log("handleMouseDown",e),O(e),J(e)},ge=function(e){console.log("handleMouseUp",e),Q()},ve=function(e){console.log("handleTouchStart",e),J(e)};return(0,n.jsxs)("div",{style:{width:r+"px",height:"auto",border:"1px solid black"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("input",{type:"range",min:"0",max:"360",value:j,onChange:function(e){return i(Number(e.target.value))},style:{marginBottom:"10px"}}),(0,n.jsx)("button",{type:"button",onClick:F,style:{marginBottom:"10px"},children:"\u5BFC\u51FA\u56FE\u7247"})]}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{type:"button",onClick:m,children:h?"Switch to Brush":"Switch to Eraser"})}),(0,n.jsxs)(u.Hf,{ref:g,width:r,height:d,onMousemove:ce,onMouseDown:he,onMouseup:ge,onTouchStart:ve,children:[(0,n.jsxs)(u.mh,{children:[(0,n.jsx)($,{src:M,stageWidth:r,stageHeight:d,rotation:j,setImgRef:H}),S.map(function(l,e){return(0,n.jsx)(ee,{shapeProps:l,isSelected:l.id===D,onSelect:function(){I(l.id)},onChange:function(N){var Y=S.slice();Y[e]=N,w(Y)},shapeType:l.type},e)})]}),(0,n.jsxs)(u.mh,{children:[P.map(function(l,e){return(0,n.jsx)(u.x1,{points:l.points,stroke:l.tool==="eraser"?"white":"black",strokeWidth:5,tension:.5,lineCap:"round",globalCompositeOperation:l.tool==="eraser"?"destination-out":"source-over"},e)}),h&&(0,n.jsx)(u.Cd,{x:p.x,y:p.y,radius:10,fill:"red"})]})]})]})},ue=ie,de=function(){var a="https://qn.huat.xyz/mac/202406051057150.jpeg",r=700,d=500;return(0,n.jsx)("div",{children:(0,n.jsx)(ue,{stageWidth:r,stageHeight:d,src:a})})},le=de},97629:function(q,V,o){var R=o(93236);q.exports=function(t,u,T){const c=R.useRef("loading"),U=R.useRef(),[_,B]=R.useState(0),z=R.useRef(),n=R.useRef(),K=R.useRef();return(z.current!==t||n.current!==u||K.current!==T)&&(c.current="loading",U.current=void 0,z.current=t,n.current=u,K.current=T),R.useLayoutEffect(function(){if(!t)return;var y=document.createElement("img");function $(){c.current="loaded",U.current=y,B(Math.random())}function G(){c.current="failed",U.current=void 0,B(Math.random())}return y.addEventListener("load",$),y.addEventListener("error",G),u&&(y.crossOrigin=u),T&&(y.referrerPolicy=T),y.src=t,function(){y.removeEventListener("load",$),y.removeEventListener("error",G)}},[t,u,T]),[U.current,c.current]}}}]);
