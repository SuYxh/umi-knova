(self.webpackChunk=self.webpackChunk||[]).push([[572],{94502:function(re,N,o){"use strict";o.r(N),o.d(N,{default:function(){return pe}});var w=o(48305),S=o.n(w),a=o(93236),u=o(53531),k=o(26068),h=o.n(k),W=o(67825),se=o.n(W),A=o(97629),z=o.n(A),t=o(62086),K=["src","stageWidth","stageHeight","rotation","setImgRef"],L=function(n){var r=n.src,l=n.stageWidth,M=n.stageHeight,p=n.rotation,g=n.setImgRef,C=se()(n,K),b=z()(r,"anonymous"),R=S()(b,1),i=R[0],f=(0,a.useRef)(null),s=(0,a.useState)({width:0,height:0,x:0,y:0}),x=S()(s,2),j=x[0],T=x[1];return(0,a.useEffect)(function(){if(i){var D=Math.min(l,M),I=Math.max(i.width,i.height),y=D/I*.8,F=i.width*y,B=i.height*y;T({width:F,height:B,x:l/2,y:M/2})}g(f.current)},[i,l,M,g]),(0,t.jsx)(u.Ee,h()(h()({ref:f,image:i,rotation:p,offsetX:j.width/2,offsetY:j.height/2},j),C))},$=L,G=function(n){var r=n.shapeProps,l=n.isSelected,M=n.onSelect,p=n.onChange,g=n.shapeType,C=a.useRef(),b=a.useRef();a.useEffect(function(){l&&(b.current.nodes([C.current]),b.current.getLayer().batchDraw())},[l]);var R=g==="rect"?u.UL:g==="ellipse"?u.Pj:u.Eh;return(0,t.jsxs)(a.Fragment,{children:[(0,t.jsx)(R,h()(h()({onClick:M,onTap:M,ref:C},r),{},{draggable:!0,onDragEnd:function(f){p(h()(h()({},r),{},{x:f.target.x(),y:f.target.y()}))},onTransformEnd:function(f){var s=C.current,x=s.scaleX(),j=s.scaleY();if(s.scaleX(1),s.scaleY(1),g==="arrow"){var T=s.points(),D=T.map(function(I,y){return y%2===0?I*x:I*j});p(h()(h()({},r),{},{points:D}))}else p(h()(h()({},r),{},{x:s.x(),y:s.y(),width:s.width()*x,height:s.height()*j}))}})),l&&(0,t.jsx)(u.$T,{ref:b,flipEnabled:!1,boundBoxFunc:function(f,s){return Math.abs(s.width)<5||Math.abs(s.height)<5?f:s}})]})},oe=G,le=o(15558),ie=o.n(le);function de(){var U=(0,a.useState)([]),n=S()(U,2),r=n[0],l=n[1],M=(0,a.useState)(!1),p=S()(M,2),g=p[0],C=p[1],b=(0,a.useState)(!1),R=S()(b,2),i=R[0],f=R[1],s=(0,a.useState)({x:0,y:0}),x=S()(s,2),j=x[0],T=x[1],D=(0,a.useState)(!1),I=S()(D,2),y=I[0],F=I[1],B=function(d){var v=d.target.checked;v||f(!1),F(v)},J=function(d){l([].concat(ie()(r),[{points:[d.x,d.y],tool:i?"eraser":"brush"}]))},E=function(d){var v=r[r.length-1];v.points=[].concat(ie()(v.points),[d.x,d.y]);var m=r.slice();m.splice(r.length-1,1,v),l(m)},_=function(d){var v=10,m=r.filter(function(V){return V.points.every(function(ae,Z){return Z%2===0?Math.hypot(ae-d.x,V.points[Z+1]-d.y)>v:!0})});l(m)},O=function(){f(!i)},Q=function(d){if(y){C(!0);var v=d.target.getStage(),m=v.getPointerPosition();J(m)}},ee=function(d){if(y){var v=d.target.getStage(),m=v.getPointerPosition();T(m),g&&E(m),i&&!g&&_(m)}},te=function(){C(!1)};return{lines:r,isDrawing:g,eraserEnabled:i,eraserPosition:j,isSelectPen:y,toggleEraser:O,handleCheckboxChange:B,handleMouseMoveLine:ee,handleMouseDownLine:Q,handleMouseUpLine:te}}var ce=de,he=[{x:10,y:10,width:100,height:100,fill:"red",id:"rect1",type:"rect"},{x:150,y:150,radiusX:50,radiusY:25,stroke:"black",strokeWidth:2,id:"ellipse1",type:"ellipse"},{x:300,y:100,width:150,height:75,stroke:"blue",strokeWidth:2,id:"rect2",type:"rect"},{points:[250,100,350,200],pointerLength:10,pointerWidth:10,fill:"black",stroke:"black",strokeWidth:4,id:"arrow1",type:"arrow"}],q={"operation-area":"operation-area___hPPAe","operation-image":"operation-image___x23X4","operation-pen":"operation-pen___BYShq"},ge=function(n){var r=n.stageWidth,l=n.stageHeight,M=n.src,p=(0,a.useRef)(null),g=(0,a.useRef)(null),C=(0,a.useState)(0),b=S()(C,2),R=b[0],i=b[1],f=(0,a.useState)(he),s=S()(f,2),x=s[0],j=s[1],T=(0,a.useState)(null),D=S()(T,2),I=D[0],y=D[1],F=function(e){p.current=e},B=function(){if(p.current&&g.current){var e=p.current,H=e.scaleX(),ne=e.scaleY(),X=e.width()*H,ue=e.height()*ne,Se=e.x()-X/2,xe=e.y()-ue/2,ye=g.current.toDataURL({x:Se,y:xe,width:X,height:ue,pixelRatio:2}),Y=document.createElement("a");Y.download="cropped-image.png",Y.href=ye,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y)}},J=function(e){var H=e.target===e.target.getStage();H&&y(null)},E=ce(),_=E.lines,O=E.eraserEnabled,Q=E.eraserPosition,ee=E.isSelectPen,te=E.toggleEraser,P=E.handleCheckboxChange,d=E.handleMouseDownLine,v=E.handleMouseMoveLine,m=E.handleMouseUpLine,V=function(e){console.log("handleMouseDown",e),v(e)},ae=function(e){console.log("handleMouseDown",e),d(e),J(e)},Z=function(e){console.log("handleMouseUp",e),m()},me=function(e){console.log("handleTouchStart",e),J(e)};return(0,t.jsxs)("div",{style:{width:r+"px",height:"auto",border:"1px solid black"},children:[(0,t.jsxs)("div",{className:q["operation-area"],children:[(0,t.jsxs)("div",{className:q["operation-image"],children:[(0,t.jsx)("span",{children:"\u56FE\u7247\u65CB\u8F6C:"}),(0,t.jsx)("input",{type:"range",min:"0",max:"360",value:R,onChange:function(e){return i(Number(e.target.value))},style:{marginBottom:"10px"}}),(0,t.jsx)("button",{type:"button",onClick:B,style:{marginLeft:"10px"},children:"\u5BFC\u51FA\u56FE\u7247"})]}),(0,t.jsxs)("div",{className:q["operation-pen"],children:[(0,t.jsxs)("label",{children:[(0,t.jsx)("input",{type:"checkbox",checked:ee,onChange:P}),"\u5F00\u59CB\u7ED8\u753B"]}),(0,t.jsx)("button",{type:"button",onClick:te,style:{marginLeft:"10px"},children:O?"Switch to Brush":"Switch to Eraser"})]})]}),(0,t.jsxs)(u.Hf,{ref:g,width:r,height:l,onMousemove:V,onMouseDown:ae,onMouseup:Z,onTouchStart:me,children:[(0,t.jsxs)(u.mh,{children:[(0,t.jsx)($,{src:M,stageWidth:r,stageHeight:l,rotation:R,setImgRef:F}),x.map(function(c,e){return(0,t.jsx)(oe,{shapeProps:c,isSelected:c.id===I,onSelect:function(){y(c.id)},onChange:function(ne){var X=x.slice();X[e]=ne,j(X)},shapeType:c.type},e)})]}),(0,t.jsxs)(u.mh,{children:[_.map(function(c,e){return(0,t.jsx)(u.x1,{points:c.points,stroke:c.tool==="eraser"?"white":"black",strokeWidth:5,tension:.5,lineCap:"round",globalCompositeOperation:c.tool==="eraser"?"destination-out":"source-over"},e)}),O&&(0,t.jsx)(u.Cd,{x:Q.x,y:Q.y,radius:10,fill:"red"})]})]})]})},ve=ge,fe=function(){var n="https://qn.huat.xyz/mac/202406051057150.jpeg",r=700,l=500;return(0,t.jsx)("div",{children:(0,t.jsx)(ve,{stageWidth:r,stageHeight:l,src:n})})},pe=fe},97629:function(re,N,o){var w=o(93236);re.exports=function(a,u,k){const h=w.useRef("loading"),W=w.useRef(),[se,A]=w.useState(0),z=w.useRef(),t=w.useRef(),K=w.useRef();return(z.current!==a||t.current!==u||K.current!==k)&&(h.current="loading",W.current=void 0,z.current=a,t.current=u,K.current=k),w.useLayoutEffect(function(){if(!a)return;var L=document.createElement("img");function $(){h.current="loaded",W.current=L,A(Math.random())}function G(){h.current="failed",W.current=void 0,A(Math.random())}return L.addEventListener("load",$),L.addEventListener("error",G),u&&(L.crossOrigin=u),k&&(L.referrerPolicy=k),L.src=a,function(){L.removeEventListener("load",$),L.removeEventListener("error",G)}},[a,u,k]),[W.current,h.current]}}}]);
