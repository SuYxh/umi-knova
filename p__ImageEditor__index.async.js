"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[572],{48608:function(Ve,Z,p){p.r(Z),p.d(Z,{default:function(){return De}});var ne=p(15558),U=p.n(ne),ae=p(48305),f=p.n(ae),s=p(93236),b=p(53531),oe=p(1463),t=p(62086),re=function(n){var r=n.defaultColor,a=n.onColorSelected,c=(0,s.useState)(r||"#ff483c"),l=f()(c,2),d=l[0],k=l[1],w=(0,s.useState)(!1),L=f()(w,2),h=L[0],x=L[1],u=function(){x(!h)},y=function(){x(!1)},j=function(T){k(T.hex),a(T.hex),y()};return(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{padding:"5px",background:d,borderRadius:"2px",boxShadow:"0 0 0 1px rgba(0,0,0,.1)",display:"inline-block",cursor:"pointer"},onClick:u,children:(0,t.jsx)("div",{style:{width:"36px",height:"14px",borderRadius:"2px",background:d}})}),h?(0,t.jsxs)("div",{style:{position:"absolute",zIndex:"2"},children:[(0,t.jsx)("div",{style:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"},onClick:y}),(0,t.jsx)(oe.xS,{color:d,onChangeComplete:j})]}):null]})},se=re,ie=function(n){var r=n.lines,a=n.eraserEnabled,c=n.eraserPosition;return(0,t.jsxs)(b.mh,{children:[r.map(function(l,d){return(0,t.jsx)(b.x1,{points:l.points,stroke:l.tool==="eraser"?"white":"black",strokeWidth:5,tension:.5,lineCap:"round",globalCompositeOperation:l.tool==="eraser"?"destination-out":"source-over"},d)}),a&&(0,t.jsx)(b.Cd,{x:c.x,y:c.y,radius:10,fill:"red"})]})},le=ie,ue=p(26068),M=p.n(ue),ce=p(67825),de=p.n(ce),he=p(97629),ve=p.n(he),ge=["src","stageWidth","stageHeight","rotation","setImgRef"],pe=function(n){var r=n.src,a=n.stageWidth,c=n.stageHeight,l=n.rotation,d=n.setImgRef,k=de()(n,ge),w=ve()(r,"anonymous"),L=f()(w,1),h=L[0],x=(0,s.useRef)(null),u=(0,s.useState)({width:0,height:0,x:0,y:0}),y=f()(u,2),j=y[0],P=y[1];return(0,s.useEffect)(function(){if(h){var T=Math.min(a,c),S=Math.max(h.width,h.height),C=T/S*.8,H=h.width*C,Y=h.height*C;P({width:H,height:Y,x:a/2,y:c/2})}d(x.current)},[h,a,c,d]),(0,t.jsx)(b.Ee,M()(M()({ref:x,image:h,rotation:l,offsetX:j.width/2,offsetY:j.height/2},j),k))},fe=pe,xe=function(n){var r=n.shapeProps,a=n.isSelected,c=n.onSelect,l=n.onChange,d=n.shapeType,k=s.useRef(),w=s.useRef();s.useEffect(function(){a&&(w.current.nodes([k.current]),w.current.getLayer().batchDraw())},[a]);var L=d==="rect"?b.UL:d==="ellipse"?b.Pj:b.Eh;return(0,t.jsxs)(s.Fragment,{children:[(0,t.jsx)(L,M()(M()({onClick:c,onTap:c,ref:k},r),{},{draggable:!0,onDragEnd:function(x){l(M()(M()({},r),{},{x:x.target.x(),y:x.target.y()}))},onTransformEnd:function(x){var u=k.current,y=u.scaleX(),j=u.scaleY();if(u.scaleX(1),u.scaleY(1),d==="arrow"){var P=u.points(),T=P.map(function(S,C){return C%2===0?S*y:S*j});l(M()(M()({},r),{},{points:T}))}else l(M()(M()({},r),{},{x:u.x(),y:u.y(),width:u.width()*y,height:u.height()*j}))}})),a&&(0,t.jsx)(b.$T,{ref:w,flipEnabled:!1,boundBoxFunc:function(x,u){return Math.abs(u.width)<5||Math.abs(u.height)<5?x:u}})]})},me=xe,Se=function(n){var r=n.textList;return(0,t.jsx)(b.mh,{children:r.map(function(a,c){return(0,t.jsx)(b.xv,{text:a.text,x:a.x,y:a.y,draggable:a.draggable,fill:a.fill},c)})})},Ce=Se;function ye(){var D=(0,s.useState)([]),n=f()(D,2),r=n[0],a=n[1],c=(0,s.useState)(!1),l=f()(c,2),d=l[0],k=l[1],w=(0,s.useState)(!1),L=f()(w,2),h=L[0],x=L[1],u=(0,s.useState)({x:0,y:0}),y=f()(u,2),j=y[0],P=y[1],T=(0,s.useState)(!1),S=f()(T,2),C=S[0],H=S[1],Y=function(g){var m=g.target.checked;m||x(!1),H(m)},F=function(g){a([].concat(U()(r),[{points:[g.x,g.y],tool:h?"eraser":"brush"}]))},K=function(g){var m=r[r.length-1];m.points=[].concat(U()(m.points),[g.x,g.y]);var E=r.slice();E.splice(r.length-1,1,m),a(E)},J=function(g){var m=10,E=r.filter(function(X){return X.points.every(function($,G){return G%2===0?Math.hypot($-g.x,X.points[G+1]-g.y)>m:!0})});a(E)},z=function(){if(!C){alert("\u8BF7\u9009\u4E2D\u753B\u7B14");return}x(!h)},W=function(g){if(C){k(!0);var m=g.target.getStage(),E=m.getPointerPosition();F(E)}},O=function(g){if(C){var m=g.target.getStage(),E=m.getPointerPosition();P(E),d&&K(E),h&&!d&&J(E)}},Q=function(){k(!1)};return{lines:r,isDrawing:d,eraserEnabled:h,eraserPosition:j,isSelectPen:C,toggleEraser:z,handleCheckboxChange:Y,handleMouseMoveLine:O,handleMouseDownLine:W,handleMouseUpLine:Q}}var be=ye,ke=[{x:200,y:300,width:100,height:100,fill:"red",id:"rect1",type:"rect"},{x:150,y:150,radiusX:50,radiusY:25,stroke:"black",strokeWidth:2,id:"ellipse1",type:"ellipse"},{x:300,y:100,width:150,height:75,stroke:"blue",strokeWidth:2,id:"rect2",type:"rect"},{points:[250,100,350,200],pointerLength:10,pointerWidth:10,fill:"black",stroke:"black",strokeWidth:4,id:"arrow1",type:"arrow"}],B={"operation-area":"operation-area___hPPAe","operation-image":"operation-image___x23X4","operation-pen":"operation-pen___BYShq","operation-line":"operation-line___L4lcy","operation-color":"operation-color___YPiTH","operation-btn":"operation-btn___eTeGw","operation-text":"operation-text___NNpbO"};function we(D,n){var r,a;return function(){var c=this,l=arguments;a?(clearTimeout(r),r=setTimeout(function(){Date.now()-a>=n&&(D.apply(c,l),a=Date.now())},n-(Date.now()-a))):(D.apply(c,l),a=Date.now())}}var Le=function(n){var r=n.stageWidth,a=n.stageHeight,c=n.src,l=(0,s.useRef)(null),d=(0,s.useRef)(null),k=(0,s.useState)(0),w=f()(k,2),L=w[0],h=w[1],x=(0,s.useState)(5),u=f()(x,2),y=u[0],j=u[1],P=(0,s.useState)(ke),T=f()(P,2),S=T[0],C=T[1],H=(0,s.useState)(null),Y=f()(H,2),F=Y[0],K=Y[1],J=(0,s.useState)([]),z=f()(J,2),W=z[0],O=z[1],Q=(0,s.useState)(""),I=f()(Q,2),g=I[0],m=I[1],E=(0,s.useState)(""),X=f()(E,2),$=X[0],G=X[1];(0,s.useEffect)(function(){console.log("useEffect-->textList",W)},[W]);var q=function(){var e=new Date().getTime(),i={text:g,x:100,y:100,draggable:!0,fill:"black",id:"rect-".concat(e),type:"text"};O([].concat(U()(W),[i])),m("")},Te=function(){console.log("deleteText-origin",W);var e=W.filter(function(i){return i.text!==$});console.log("deleteText-newTextList",e),O(U()(e))},Me=function(e){var i=e.target.getClassName();if(console.log("handleClickText-name",i),i==="Text"){var v=e.target.attrs.text;console.log("handleClickText-t",v),G(v)}},R=be(),Pe=R.lines,_=R.eraserEnabled,Ie=R.eraserPosition,Re=R.isSelectPen,We=R.toggleEraser,Be=R.handleCheckboxChange,Fe=R.handleMouseDownLine,Ae=R.handleMouseMoveLine,Ue=R.handleMouseUpLine,Ye=function(e){l.current=e},He=function(){if(l.current&&d.current){var e=l.current,i=e.scaleX(),v=e.scaleY(),A=e.width()*i,te=e.height()*v,Ge=e.x()-A/2,Je=e.y()-te/2,Qe=d.current.toDataURL({x:Ge,y:Je,width:A,height:te,pixelRatio:2}),N=document.createElement("a");N.download="cropped-image.png",N.href=Qe,document.body.appendChild(N),N.click(),document.body.removeChild(N)}},ee=function(e){var i=e.target===e.target.getStage();i&&K(null)},Xe=function(e){var i;console.log("onColorSelected",e);var v=(i=S.find(function(A){return A.id===F}))!==null&&i!==void 0?i:{};if(v.type){switch(v.type){case"rect":v.stroke=e;break;case"ellipse":v.stroke=e;break;case"arrow":v.stroke=e,v.fill=e;break;default:break}C([].concat(U()(S),[v]))}},Ne=function(){console.log("\u5F53\u524D\u9009\u4E2D\u7684\u56FE\u5F62",F);var e=S.filter(function(i){return i.id!==F});C(e)},V=function(e){var i={},v=new Date().getTime();switch(e){case"rect":i={x:300,y:100,width:150,height:75,stroke:"blue",strokeWidth:2,id:"rect-".concat(v),type:"rect"};break;case"ellipse":i={x:150,y:150,radiusX:50,radiusY:25,stroke:"black",strokeWidth:2,id:"ellipse-".concat(v),type:"ellipse"};break;case"arrow":i={points:[250,100,350,200],pointerLength:10,pointerWidth:10,fill:"black",stroke:"black",strokeWidth:4,id:"arrow-".concat(v),type:"arrow"};break;default:break}C([].concat(U()(S),[i]))},Ke=we(function(o){console.log("handleMouseMove",o),Ae(o)},500),ze=function(e){console.log("handleMouseDown",e),Fe(e),ee(e),Me(e)},Oe=function(e){console.log("handleMouseUp",e),Ue()},$e=function(e){console.log("handleTouchStart",e),ee(e)};return(0,s.useEffect)(function(){var o=function(i){i.key==="Backspace"&&(console.log("\u9000\u683C\u952E\u88AB\u6309\u4E0B\u4E86"),Ne(),Te())};return document.addEventListener("keydown",o),function(){document.removeEventListener("keydown",o)}},[F,$]),(0,t.jsxs)("div",{style:{width:r+"px",height:"auto",border:"1px solid black"},children:[(0,t.jsxs)("div",{className:B["operation-area"],children:[(0,t.jsxs)("div",{className:B["operation-image"],children:[(0,t.jsx)("span",{children:"\u56FE\u7247\u65CB\u8F6C:"}),(0,t.jsx)("input",{type:"range",min:"0",max:"360",value:L,onChange:function(e){return h(Number(e.target.value))},style:{marginBottom:"10px"}}),(0,t.jsx)("button",{type:"button",onClick:He,style:{marginLeft:"10px"},children:"\u5BFC\u51FA\u56FE\u7247"})]}),(0,t.jsxs)("div",{className:B["operation-pen"],children:[(0,t.jsxs)("label",{children:[(0,t.jsx)("input",{type:"checkbox",checked:Re,onChange:Be}),"\u5F00\u59CB\u7ED8\u753B"]}),(0,t.jsx)("button",{type:"button",onClick:We,style:{marginLeft:"10px"},children:_?"Switch to Brush":"Switch to Eraser"})]}),(0,t.jsxs)("div",{className:B["operation-line"],children:[(0,t.jsx)("span",{children:"\u7EBF\u6761\u7C97\u7EC6:"}),(0,t.jsx)("input",{type:"range",min:"0",max:"100",value:y,onChange:function(e){return j(Number(e.target.value))},style:{marginBottom:"10px"}})]}),(0,t.jsxs)("div",{className:B["operation-color"],children:[(0,t.jsx)("span",{children:"\u9009\u62E9\u989C\u8272:"}),(0,t.jsx)(se,{onColorSelected:Xe})]}),(0,t.jsxs)("div",{className:B["operation-btn"],children:[(0,t.jsx)("button",{type:"button",onClick:function(){return V("rect")},children:"\u6DFB\u52A0\u77E9\u5F62"}),(0,t.jsx)("button",{type:"button",onClick:function(){return V("ellipse")},children:"\u6DFB\u52A0\u692D\u5706"}),(0,t.jsx)("button",{type:"button",onClick:function(){return V("arrow")},children:"\u6DFB\u52A0\u7BAD\u5934"})]}),(0,t.jsxs)("div",{className:B["operation-text"],children:[(0,t.jsx)("input",{value:g,onChange:function(e){return m(e.target.value)},onKeyDown:function(e){e.key==="Enter"&&q()},style:{marginBottom:"10px"}}),(0,t.jsx)("button",{type:"button",onClick:q,children:"\u6DFB\u52A0\u6587\u6848"})]})]}),(0,t.jsxs)(b.Hf,{ref:d,width:r,height:a,onMousemove:Ke,onMouseDown:ze,onMouseup:Oe,onTouchStart:$e,children:[(0,t.jsxs)(b.mh,{children:[(0,t.jsx)(fe,{src:c,stageWidth:r,stageHeight:a,rotation:L,setImgRef:Ye}),S.map(function(o,e){return(0,t.jsx)(me,{shapeProps:o,isSelected:o.id===F,onSelect:function(){console.log("Shape-onSelect",o.id),K(o.id)},onChange:function(v){var A=S.slice();A[e]=v,C(A)},shapeType:o.type},e)})]}),(0,t.jsx)(le,{lines:Pe,eraserEnabled:_,eraserPosition:Ie}),(0,t.jsx)(Ce,{textList:W})]})]})},je=Le,Ee=function(){var n="https://qn.huat.xyz/mac/202406051057150.jpeg",r=700,a=500;return(0,t.jsx)("div",{children:(0,t.jsx)(je,{stageWidth:r,stageHeight:a,src:n})})},De=Ee}}]);
