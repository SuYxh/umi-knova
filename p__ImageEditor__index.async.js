"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[572],{42074:function(Re,V,h){h.r(V),h.d(V,{default:function(){return be}});var _=h(15558),H=h.n(_),ee=h(48305),m=h.n(ee),r=h(93236),D=h(53531),te=h(1463),t=h(62086),ne=function(n){var a=n.defaultColor,i=n.onColorSelected,p=(0,r.useState)(a||"#ff483c"),c=m()(p,2),l=c[0],y=c[1],b=(0,r.useState)(!1),k=m()(b,2),u=k[0],v=k[1],s=function(){v(!u)},C=function(){v(!1)},w=function(E){y(E.hex),i(E.hex),C()};return(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{padding:"5px",background:l,borderRadius:"2px",boxShadow:"0 0 0 1px rgba(0,0,0,.1)",display:"inline-block",cursor:"pointer"},onClick:s,children:(0,t.jsx)("div",{style:{width:"36px",height:"14px",borderRadius:"2px",background:l}})}),u?(0,t.jsxs)("div",{style:{position:"absolute",zIndex:"2"},children:[(0,t.jsx)("div",{style:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"},onClick:C}),(0,t.jsx)(te.xS,{color:l,onChangeComplete:w})]}):null]})},ae=ne,oe=function(n){var a=n.lines,i=n.eraserEnabled,p=n.eraserPosition;return(0,t.jsxs)(D.mh,{children:[a.map(function(c,l){return(0,t.jsx)(D.x1,{points:c.points,stroke:c.tool==="eraser"?"white":"black",strokeWidth:5,tension:.5,lineCap:"round",globalCompositeOperation:c.tool==="eraser"?"destination-out":"source-over"},l)}),i&&(0,t.jsx)(D.Cd,{x:p.x,y:p.y,radius:10,fill:"red"})]})},re=oe,se=h(26068),P=h.n(se),ie=h(67825),le=h.n(ie),ue=h(97629),ce=h.n(ue),de=["src","stageWidth","stageHeight","rotation","setImgRef"],he=function(n){var a=n.src,i=n.stageWidth,p=n.stageHeight,c=n.rotation,l=n.setImgRef,y=le()(n,de),b=ce()(a,"anonymous"),k=m()(b,1),u=k[0],v=(0,r.useRef)(null),s=(0,r.useState)({width:0,height:0,x:0,y:0}),C=m()(s,2),w=C[0],I=C[1];return(0,r.useEffect)(function(){if(u){var E=Math.min(i,p),f=Math.max(u.width,u.height),x=E/f*.8,U=u.width*x,A=u.height*x;I({width:U,height:A,x:i/2,y:p/2})}l(v.current)},[u,i,p,l]),(0,t.jsx)(D.Ee,P()(P()({ref:v,image:u,rotation:c,offsetX:w.width/2,offsetY:w.height/2},w),y))},ve=he,ge=function(n){var a=n.shapeProps,i=n.isSelected,p=n.onSelect,c=n.onChange,l=n.shapeType,y=r.useRef(),b=r.useRef();r.useEffect(function(){i&&(b.current.nodes([y.current]),b.current.getLayer().batchDraw())},[i]);var k=l==="rect"?D.UL:l==="ellipse"?D.Pj:D.Eh;return(0,t.jsxs)(r.Fragment,{children:[(0,t.jsx)(k,P()(P()({onClick:p,onTap:p,ref:y},a),{},{draggable:!0,onDragEnd:function(v){c(P()(P()({},a),{},{x:v.target.x(),y:v.target.y()}))},onTransformEnd:function(v){var s=y.current,C=s.scaleX(),w=s.scaleY();if(s.scaleX(1),s.scaleY(1),l==="arrow"){var I=s.points(),E=I.map(function(f,x){return x%2===0?f*C:f*w});c(P()(P()({},a),{},{points:E}))}else c(P()(P()({},a),{},{x:s.x(),y:s.y(),width:s.width()*C,height:s.height()*w}))}})),i&&(0,t.jsx)(D.$T,{ref:b,flipEnabled:!1,boundBoxFunc:function(v,s){return Math.abs(s.width)<5||Math.abs(s.height)<5?v:s}})]})},pe=ge;function fe(){var T=(0,r.useState)([]),n=m()(T,2),a=n[0],i=n[1],p=(0,r.useState)(!1),c=m()(p,2),l=c[0],y=c[1],b=(0,r.useState)(!1),k=m()(b,2),u=k[0],v=k[1],s=(0,r.useState)({x:0,y:0}),C=m()(s,2),w=C[0],I=C[1],E=(0,r.useState)(!1),f=m()(E,2),x=f[0],U=f[1],A=function(g){var S=g.target.checked;S||v(!1),U(S)},R=function(g){i([].concat(H()(a),[{points:[g.x,g.y],tool:u?"eraser":"brush"}]))},X=function(g){var S=a[a.length-1];S.points=[].concat(H()(S.points),[g.x,g.y]);var j=a.slice();j.splice(a.length-1,1,S),i(j)},L=function(g){var S=10,j=a.filter(function(K){return K.points.every(function(J,N){return N%2===0?Math.hypot(J-g.x,K.points[N+1]-g.y)>S:!0})});i(j)},O=function(){if(!x){alert("\u8BF7\u9009\u4E2D\u753B\u7B14");return}v(!u)},z=function(g){if(x){y(!0);var S=g.target.getStage(),j=S.getPointerPosition();R(j)}},$=function(g){if(x){var S=g.target.getStage(),j=S.getPointerPosition();I(j),l&&X(j),u&&!l&&L(j)}},G=function(){y(!1)};return{lines:a,isDrawing:l,eraserEnabled:u,eraserPosition:w,isSelectPen:x,toggleEraser:O,handleCheckboxChange:A,handleMouseMoveLine:$,handleMouseDownLine:z,handleMouseUpLine:G}}var xe=fe,Se=[{x:200,y:300,width:100,height:100,fill:"red",id:"rect1",type:"rect"},{x:150,y:150,radiusX:50,radiusY:25,stroke:"black",strokeWidth:2,id:"ellipse1",type:"ellipse"},{x:300,y:100,width:150,height:75,stroke:"blue",strokeWidth:2,id:"rect2",type:"rect"},{points:[250,100,350,200],pointerLength:10,pointerWidth:10,fill:"black",stroke:"black",strokeWidth:4,id:"arrow1",type:"arrow"}],F={"operation-area":"operation-area___hPPAe","operation-image":"operation-image___x23X4","operation-pen":"operation-pen___BYShq","operation-line":"operation-line___L4lcy","operation-color":"operation-color___YPiTH","operation-btn":"operation-btn___eTeGw"},me=function(n){var a=n.stageWidth,i=n.stageHeight,p=n.src,c=(0,r.useRef)(null),l=(0,r.useRef)(null),y=(0,r.useState)(0),b=m()(y,2),k=b[0],u=b[1],v=(0,r.useState)(5),s=m()(v,2),C=s[0],w=s[1],I=(0,r.useState)(Se),E=m()(I,2),f=E[0],x=E[1],U=(0,r.useState)(null),A=m()(U,2),R=A[0],X=A[1];(0,r.useEffect)(function(){console.log("selectedId change",R)},[R]);var L=xe(),O=L.lines,z=L.eraserEnabled,$=L.eraserPosition,G=L.isSelectPen,W=L.toggleEraser,g=L.handleCheckboxChange,S=L.handleMouseDownLine,j=L.handleMouseMoveLine,K=L.handleMouseUpLine,J=function(e){c.current=e},N=function(){if(c.current&&l.current){var e=c.current,d=e.scaleX(),M=e.scaleY(),B=e.width()*d,q=e.height()*M,De=e.x()-B/2,Pe=e.y()-q/2,Ie=l.current.toDataURL({x:De,y:Pe,width:B,height:q,pixelRatio:2}),Y=document.createElement("a");Y.download="cropped-image.png",Y.href=Ie,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y)}},Z=function(e){var d=e.target===e.target.getStage();d&&X(null)},ke=function(e){var d;console.log("onColorSelected",e);var M=(d=f.find(function(B){return B.id===R}))!==null&&d!==void 0?d:{};if(M.type){switch(M.type){case"rect":M.stroke=e;break;case"ellipse":M.stroke=e;break;case"arrow":M.stroke=e,M.fill=e;break;default:break}x([].concat(H()(f),[M]))}},we=function(){console.log("\u5F53\u524D\u9009\u4E2D\u7684\u56FE\u5F62",R);var e=f.filter(function(d){return d.id!==R});x(e)},Q=function(e){var d={};switch(e){case"rect":d={x:300,y:100,width:150,height:75,stroke:"blue",strokeWidth:2,id:"rect2",type:"rect"};break;case"ellipse":d={x:150,y:150,radiusX:50,radiusY:25,stroke:"black",strokeWidth:2,id:"ellipse1",type:"ellipse"};break;case"arrow":d={points:[250,100,350,200],pointerLength:10,pointerWidth:10,fill:"black",stroke:"black",strokeWidth:4,id:"arrow1",type:"arrow"};break;default:break}x([].concat(H()(f),[d]))},je=function(e){console.log("handleMouseDown",e),j(e)},Ee=function(e){console.log("handleMouseDown",e),S(e),Z(e)},Le=function(e){console.log("handleMouseUp",e),K()},Me=function(e){console.log("handleTouchStart",e),Z(e)};return(0,r.useEffect)(function(){var o=function(d){d.key==="Backspace"&&(console.log("\u9000\u683C\u952E\u88AB\u6309\u4E0B\u4E86"),we())};return document.addEventListener("keydown",o),function(){document.removeEventListener("keydown",o)}},[R]),(0,t.jsxs)("div",{style:{width:a+"px",height:"auto",border:"1px solid black"},children:[(0,t.jsxs)("div",{className:F["operation-area"],children:[(0,t.jsxs)("div",{className:F["operation-image"],children:[(0,t.jsx)("span",{children:"\u56FE\u7247\u65CB\u8F6C:"}),(0,t.jsx)("input",{type:"range",min:"0",max:"360",value:k,onChange:function(e){return u(Number(e.target.value))},style:{marginBottom:"10px"}}),(0,t.jsx)("button",{type:"button",onClick:N,style:{marginLeft:"10px"},children:"\u5BFC\u51FA\u56FE\u7247"})]}),(0,t.jsxs)("div",{className:F["operation-pen"],children:[(0,t.jsxs)("label",{children:[(0,t.jsx)("input",{type:"checkbox",checked:G,onChange:g}),"\u5F00\u59CB\u7ED8\u753B"]}),(0,t.jsx)("button",{type:"button",onClick:W,style:{marginLeft:"10px"},children:z?"Switch to Brush":"Switch to Eraser"})]}),(0,t.jsxs)("div",{className:F["operation-line"],children:[(0,t.jsx)("span",{children:"\u7EBF\u6761\u7C97\u7EC6:"}),(0,t.jsx)("input",{type:"range",min:"0",max:"100",value:C,onChange:function(e){return w(Number(e.target.value))},style:{marginBottom:"10px"}})]}),(0,t.jsxs)("div",{className:F["operation-color"],children:[(0,t.jsx)("span",{children:"\u9009\u62E9\u989C\u8272:"}),(0,t.jsx)(ae,{onColorSelected:ke})]}),(0,t.jsxs)("div",{className:F["operation-btn"],children:[(0,t.jsx)("button",{type:"button",onClick:function(){return Q("rect")},children:"\u6DFB\u52A0\u77E9\u5F62"}),(0,t.jsx)("button",{type:"button",onClick:function(){return Q("ellipse")},children:"\u6DFB\u52A0\u692D\u5706"}),(0,t.jsx)("button",{type:"button",onClick:function(){return Q("arrow")},children:"\u6DFB\u52A0\u7BAD\u5934"})]})]}),(0,t.jsxs)(D.Hf,{ref:l,width:a,height:i,onMousemove:je,onMouseDown:Ee,onMouseup:Le,onTouchStart:Me,children:[(0,t.jsxs)(D.mh,{children:[(0,t.jsx)(ve,{src:p,stageWidth:a,stageHeight:i,rotation:k,setImgRef:J}),f.map(function(o,e){return(0,t.jsx)(pe,{shapeProps:o,isSelected:o.id===R,onSelect:function(){console.log("Shape-onSelect",o.id),X(o.id)},onChange:function(M){var B=f.slice();B[e]=M,x(B)},shapeType:o.type},e)})]}),(0,t.jsx)(re,{lines:O,eraserEnabled:z,eraserPosition:$})]})]})},Ce=me,ye=function(){var n="https://qn.huat.xyz/mac/202406051057150.jpeg",a=700,i=500;return(0,t.jsx)("div",{children:(0,t.jsx)(Ce,{stageWidth:a,stageHeight:i,src:n})})},be=ye}}]);
