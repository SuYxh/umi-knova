"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[572],{42074:function(Re,V,h){h.r(V),h.d(V,{default:function(){return be}});var _=h(15558),H=h.n(_),ee=h(48305),C=h.n(ee),r=h(93236),D=h(53531),te=h(1463),t=h(62086),ne=function(n){var a=n.defaultColor,i=n.onColorSelected,p=(0,r.useState)(a||"#ff483c"),c=C()(p,2),l=c[0],b=c[1],k=(0,r.useState)(!1),w=C()(k,2),u=w[0],v=w[1],s=function(){v(!u)},y=function(){v(!1)},j=function(L){b(L.hex),i(L.hex),y()};return(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{style:{padding:"5px",background:l,borderRadius:"2px",boxShadow:"0 0 0 1px rgba(0,0,0,.1)",display:"inline-block",cursor:"pointer"},onClick:s,children:(0,t.jsx)("div",{style:{width:"36px",height:"14px",borderRadius:"2px",background:l}})}),u?(0,t.jsxs)("div",{style:{position:"absolute",zIndex:"2"},children:[(0,t.jsx)("div",{style:{position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"},onClick:y}),(0,t.jsx)(te.xS,{color:l,onChangeComplete:j})]}):null]})},ae=ne,oe=function(n){var a=n.lines,i=n.eraserEnabled,p=n.eraserPosition;return(0,t.jsxs)(D.mh,{children:[a.map(function(c,l){return(0,t.jsx)(D.x1,{points:c.points,stroke:c.tool==="eraser"?"white":"black",strokeWidth:5,tension:.5,lineCap:"round",globalCompositeOperation:c.tool==="eraser"?"destination-out":"source-over"},l)}),i&&(0,t.jsx)(D.Cd,{x:p.x,y:p.y,radius:10,fill:"red"})]})},re=oe,se=h(26068),P=h.n(se),ie=h(67825),le=h.n(ie),ue=h(97629),ce=h.n(ue),de=["src","stageWidth","stageHeight","rotation","setImgRef"],he=function(n){var a=n.src,i=n.stageWidth,p=n.stageHeight,c=n.rotation,l=n.setImgRef,b=le()(n,de),k=ce()(a,"anonymous"),w=C()(k,1),u=w[0],v=(0,r.useRef)(null),s=(0,r.useState)({width:0,height:0,x:0,y:0}),y=C()(s,2),j=y[0],I=y[1];return(0,r.useEffect)(function(){if(u){var L=Math.min(i,p),x=Math.max(u.width,u.height),S=L/x*.8,U=u.width*S,A=u.height*S;I({width:U,height:A,x:i/2,y:p/2})}l(v.current)},[u,i,p,l]),(0,t.jsx)(D.Ee,P()(P()({ref:v,image:u,rotation:c,offsetX:j.width/2,offsetY:j.height/2},j),b))},ve=he,ge=function(n){var a=n.shapeProps,i=n.isSelected,p=n.onSelect,c=n.onChange,l=n.shapeType,b=r.useRef(),k=r.useRef();r.useEffect(function(){i&&(k.current.nodes([b.current]),k.current.getLayer().batchDraw())},[i]);var w=l==="rect"?D.UL:l==="ellipse"?D.Pj:D.Eh;return(0,t.jsxs)(r.Fragment,{children:[(0,t.jsx)(w,P()(P()({onClick:p,onTap:p,ref:b},a),{},{draggable:!0,onDragEnd:function(v){c(P()(P()({},a),{},{x:v.target.x(),y:v.target.y()}))},onTransformEnd:function(v){var s=b.current,y=s.scaleX(),j=s.scaleY();if(s.scaleX(1),s.scaleY(1),l==="arrow"){var I=s.points(),L=I.map(function(x,S){return S%2===0?x*y:x*j});c(P()(P()({},a),{},{points:L}))}else c(P()(P()({},a),{},{x:s.x(),y:s.y(),width:s.width()*y,height:s.height()*j}))}})),i&&(0,t.jsx)(D.$T,{ref:k,flipEnabled:!1,boundBoxFunc:function(v,s){return Math.abs(s.width)<5||Math.abs(s.height)<5?v:s}})]})},pe=ge;function fe(){var T=(0,r.useState)([]),n=C()(T,2),a=n[0],i=n[1],p=(0,r.useState)(!1),c=C()(p,2),l=c[0],b=c[1],k=(0,r.useState)(!1),w=C()(k,2),u=w[0],v=w[1],s=(0,r.useState)({x:0,y:0}),y=C()(s,2),j=y[0],I=y[1],L=(0,r.useState)(!1),x=C()(L,2),S=x[0],U=x[1],A=function(g){var m=g.target.checked;m||v(!1),U(m)},R=function(g){i([].concat(H()(a),[{points:[g.x,g.y],tool:u?"eraser":"brush"}]))},X=function(g){var m=a[a.length-1];m.points=[].concat(H()(m.points),[g.x,g.y]);var E=a.slice();E.splice(a.length-1,1,m),i(E)},M=function(g){var m=10,E=a.filter(function(K){return K.points.every(function(J,N){return N%2===0?Math.hypot(J-g.x,K.points[N+1]-g.y)>m:!0})});i(E)},O=function(){if(!S){alert("\u8BF7\u9009\u4E2D\u753B\u7B14");return}v(!u)},z=function(g){if(S){b(!0);var m=g.target.getStage(),E=m.getPointerPosition();R(E)}},$=function(g){if(S){var m=g.target.getStage(),E=m.getPointerPosition();I(E),l&&X(E),u&&!l&&M(E)}},G=function(){b(!1)};return{lines:a,isDrawing:l,eraserEnabled:u,eraserPosition:j,isSelectPen:S,toggleEraser:O,handleCheckboxChange:A,handleMouseMoveLine:$,handleMouseDownLine:z,handleMouseUpLine:G}}var xe=fe,Se=[{x:200,y:300,width:100,height:100,fill:"red",id:"rect1",type:"rect"},{x:150,y:150,radiusX:50,radiusY:25,stroke:"black",strokeWidth:2,id:"ellipse1",type:"ellipse"},{x:300,y:100,width:150,height:75,stroke:"blue",strokeWidth:2,id:"rect2",type:"rect"},{points:[250,100,350,200],pointerLength:10,pointerWidth:10,fill:"black",stroke:"black",strokeWidth:4,id:"arrow1",type:"arrow"}],F={"operation-area":"operation-area___hPPAe","operation-image":"operation-image___x23X4","operation-pen":"operation-pen___BYShq","operation-line":"operation-line___L4lcy","operation-color":"operation-color___YPiTH","operation-btn":"operation-btn___eTeGw"},me=function(n){var a=n.stageWidth,i=n.stageHeight,p=n.src,c=(0,r.useRef)(null),l=(0,r.useRef)(null),b=(0,r.useState)(0),k=C()(b,2),w=k[0],u=k[1],v=(0,r.useState)(5),s=C()(v,2),y=s[0],j=s[1],I=(0,r.useState)(Se),L=C()(I,2),x=L[0],S=L[1],U=(0,r.useState)(null),A=C()(U,2),R=A[0],X=A[1];(0,r.useEffect)(function(){console.log("selectedId change",R)},[R]);var M=xe(),O=M.lines,z=M.eraserEnabled,$=M.eraserPosition,G=M.isSelectPen,W=M.toggleEraser,g=M.handleCheckboxChange,m=M.handleMouseDownLine,E=M.handleMouseMoveLine,K=M.handleMouseUpLine,J=function(e){c.current=e},N=function(){if(c.current&&l.current){var e=c.current,d=e.scaleX(),f=e.scaleY(),B=e.width()*d,q=e.height()*f,De=e.x()-B/2,Pe=e.y()-q/2,Ie=l.current.toDataURL({x:De,y:Pe,width:B,height:q,pixelRatio:2}),Y=document.createElement("a");Y.download="cropped-image.png",Y.href=Ie,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y)}},Z=function(e){var d=e.target===e.target.getStage();d&&X(null)},ke=function(e){var d;console.log("onColorSelected",e);var f=(d=x.find(function(B){return B.id===R}))!==null&&d!==void 0?d:{};if(f.type){switch(f.type){case"rect":f.stroke=e;break;case"ellipse":f.stroke=e;break;case"arrow":f.stroke=e,f.fill=e;break;default:break}S([].concat(H()(x),[f]))}},we=function(){console.log("\u5F53\u524D\u9009\u4E2D\u7684\u56FE\u5F62",R);var e=x.filter(function(d){return d.id!==R});S(e)},Q=function(e){var d={},f=new Date().getTime();switch(e){case"rect":d={x:300,y:100,width:150,height:75,stroke:"blue",strokeWidth:2,id:"rect-".concat(f),type:"rect"};break;case"ellipse":d={x:150,y:150,radiusX:50,radiusY:25,stroke:"black",strokeWidth:2,id:"ellipse-".concat(f),type:"ellipse"};break;case"arrow":d={points:[250,100,350,200],pointerLength:10,pointerWidth:10,fill:"black",stroke:"black",strokeWidth:4,id:"arrow-".concat(f),type:"arrow"};break;default:break}S([].concat(H()(x),[d]))},je=function(e){console.log("handleMouseDown",e),E(e)},Ee=function(e){console.log("handleMouseDown",e),m(e),Z(e)},Le=function(e){console.log("handleMouseUp",e),K()},Me=function(e){console.log("handleTouchStart",e),Z(e)};return(0,r.useEffect)(function(){var o=function(d){d.key==="Backspace"&&(console.log("\u9000\u683C\u952E\u88AB\u6309\u4E0B\u4E86"),we())};return document.addEventListener("keydown",o),function(){document.removeEventListener("keydown",o)}},[R]),(0,t.jsxs)("div",{style:{width:a+"px",height:"auto",border:"1px solid black"},children:[(0,t.jsxs)("div",{className:F["operation-area"],children:[(0,t.jsxs)("div",{className:F["operation-image"],children:[(0,t.jsx)("span",{children:"\u56FE\u7247\u65CB\u8F6C:"}),(0,t.jsx)("input",{type:"range",min:"0",max:"360",value:w,onChange:function(e){return u(Number(e.target.value))},style:{marginBottom:"10px"}}),(0,t.jsx)("button",{type:"button",onClick:N,style:{marginLeft:"10px"},children:"\u5BFC\u51FA\u56FE\u7247"})]}),(0,t.jsxs)("div",{className:F["operation-pen"],children:[(0,t.jsxs)("label",{children:[(0,t.jsx)("input",{type:"checkbox",checked:G,onChange:g}),"\u5F00\u59CB\u7ED8\u753B"]}),(0,t.jsx)("button",{type:"button",onClick:W,style:{marginLeft:"10px"},children:z?"Switch to Brush":"Switch to Eraser"})]}),(0,t.jsxs)("div",{className:F["operation-line"],children:[(0,t.jsx)("span",{children:"\u7EBF\u6761\u7C97\u7EC6:"}),(0,t.jsx)("input",{type:"range",min:"0",max:"100",value:y,onChange:function(e){return j(Number(e.target.value))},style:{marginBottom:"10px"}})]}),(0,t.jsxs)("div",{className:F["operation-color"],children:[(0,t.jsx)("span",{children:"\u9009\u62E9\u989C\u8272:"}),(0,t.jsx)(ae,{onColorSelected:ke})]}),(0,t.jsxs)("div",{className:F["operation-btn"],children:[(0,t.jsx)("button",{type:"button",onClick:function(){return Q("rect")},children:"\u6DFB\u52A0\u77E9\u5F62"}),(0,t.jsx)("button",{type:"button",onClick:function(){return Q("ellipse")},children:"\u6DFB\u52A0\u692D\u5706"}),(0,t.jsx)("button",{type:"button",onClick:function(){return Q("arrow")},children:"\u6DFB\u52A0\u7BAD\u5934"})]})]}),(0,t.jsxs)(D.Hf,{ref:l,width:a,height:i,onMousemove:je,onMouseDown:Ee,onMouseup:Le,onTouchStart:Me,children:[(0,t.jsxs)(D.mh,{children:[(0,t.jsx)(ve,{src:p,stageWidth:a,stageHeight:i,rotation:w,setImgRef:J}),x.map(function(o,e){return(0,t.jsx)(pe,{shapeProps:o,isSelected:o.id===R,onSelect:function(){console.log("Shape-onSelect",o.id),X(o.id)},onChange:function(f){var B=x.slice();B[e]=f,S(B)},shapeType:o.type},e)})]}),(0,t.jsx)(re,{lines:O,eraserEnabled:z,eraserPosition:$})]})]})},Ce=me,ye=function(){var n="https://qn.huat.xyz/mac/202406051057150.jpeg",a=700,i=500;return(0,t.jsx)("div",{children:(0,t.jsx)(Ce,{stageWidth:a,stageHeight:i,src:n})})},be=ye}}]);
