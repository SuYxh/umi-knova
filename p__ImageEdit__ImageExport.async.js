(self.webpackChunk=self.webpackChunk||[]).push([[682],{88945:function(K,U,n){"use strict";n.r(U);var d=n(97857),F=n.n(d),E=n(5574),l=n.n(E),C=n(13769),M=n.n(C),b=n(19632),j=n.n(b),v=n(62435),x=n(79566),O=n(84420),k=n.n(O),t=n(86074),A=["src","stageWidth","stageHeight","rotation","setImgRef","onDimensionsChange"],L="https://qn.huat.xyz/mac/202406051057150.jpeg";function S(_,a,D){var m=D*Math.PI/180,g=[{x:-_/2,y:-a/2},{x:_/2,y:-a/2},{x:_/2,y:a/2},{x:-_/2,y:a/2}],u=g.map(function(e){return{x:e.x*Math.cos(m)-e.y*Math.sin(m),y:e.x*Math.sin(m)+e.y*Math.cos(m)}}),P=Math.min.apply(Math,j()(u.map(function(e){return e.x}))),h=Math.max.apply(Math,j()(u.map(function(e){return e.x}))),y=Math.min.apply(Math,j()(u.map(function(e){return e.y}))),I=Math.max.apply(Math,j()(u.map(function(e){return e.y}))),R=h-P,r=I-y;return{newWidth:R,newHeight:r}}var H=function(a){var D=a.src,m=a.stageWidth,g=a.stageHeight,u=a.rotation,P=a.setImgRef,h=a.onDimensionsChange,y=M()(a,A),I=k()(D,"anonymous"),R=l()(I,1),r=R[0],e=(0,v.useRef)(null),o=(0,v.useState)({width:0,height:0,x:0,y:0}),s=l()(o,2),i=s[0],c=s[1];return(0,v.useEffect)(function(){if(r){var f=Math.min(m,g),w=Math.max(r.width,r.height),p=f/w*.8,W=r.width*p,T=r.height*p;c({width:W,height:T,x:m/2,y:g/2}),h({width:W,height:T,ratio:p})}P(e)},[r,m,g,P]),(0,t.jsx)(x.Ee,F()(F()({ref:e,image:r,rotation:u,offsetX:i.width/2,offsetY:i.height/2},i),y))};function z(){var _={},a=600,D=500,m=(0,v.useState)(0),g=l()(m,2),u=g[0],P=g[1],h=(0,v.useRef)(null),y=function(o){h.current=o.current},I=function(o){console.log("Updated dimensions:",o),_=o},R=function(o,s,i){var c=document.createElement("canvas");c.width=s,c.height=i;var f=c.getContext("2d");return f.translate(s/2,i/2),f.rotate(u*Math.PI/180),f.drawImage(o,-s/2,-i/2),c.toDataURL()},r=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;if(h.current){var s;if(o===3){var i=h.current.attrs.image,c=i.width,f=i.height;console.log("originalWidth",c),console.log("originalHeight",f),s=R(i,c,f)}else if(o===2){console.log("rotationPic",_,u);var w=h.current.attrs.image,p=S(_.width,_.height,u);console.log("size",p);var W=p.newWidth*(1+_.ratio),T=p.newHeight*(1+_.ratio);s=R(w,W,T)}else s=h.current.toDataURL();var X={3:"rotated-original-size-image.png",2:"rotated-original-size-ratio.png",1:"rotated-image.png"},B=document.createElement("a");B.download=X[o],B.href=s,document.body.appendChild(B),B.click(),document.body.removeChild(B)}};return(0,t.jsxs)("div",{style:{width:"600px",height:"auto",border:"1px solid black"},children:[(0,t.jsx)("input",{type:"range",min:"0",max:"360",value:u,onChange:function(o){return P(o.target.value)},style:{marginBottom:"10px"}}),(0,t.jsx)("button",{type:"button",onClick:function(){return r()},style:{marginBottom:"10px"},children:"\u5BFC\u51FA\u56FE\u7247"}),(0,t.jsx)("button",{type:"button",onClick:function(){return r(3)},style:{marginBottom:"10px"},children:"\u5BFC\u51FA\u539F\u5C3A\u5BF8\u65CB\u8F6C\u56FE"}),(0,t.jsx)("button",{type:"button",onClick:function(){return r(2)},style:{marginBottom:"10px"},children:"\u5BFC\u51FA\u539F\u6BD4\u4F8B\u65CB\u8F6C\u56FE"}),(0,t.jsx)(x.Hf,{width:a,height:D,children:(0,t.jsx)(x.mh,{children:(0,t.jsx)(H,{src:L,stageWidth:a,stageHeight:D,rotation:Number(u),setImgRef:y,onDimensionsChange:I})})})]})}U.default=z},84420:function(K,U,n){var d=n(62435);K.exports=function(E,l,C){const M=d.useRef("loading"),b=d.useRef(),[j,v]=d.useState(0),x=d.useRef(),O=d.useRef(),k=d.useRef();return(x.current!==E||O.current!==l||k.current!==C)&&(M.current="loading",b.current=void 0,x.current=E,O.current=l,k.current=C),d.useLayoutEffect(function(){if(!E)return;var t=document.createElement("img");function A(){M.current="loaded",b.current=t,v(Math.random())}function L(){M.current="failed",b.current=void 0,v(Math.random())}return t.addEventListener("load",A),t.addEventListener("error",L),l&&(t.crossOrigin=l),C&&(t.referrerPolicy=C),t.src=E,function(){t.removeEventListener("load",A),t.removeEventListener("error",L)}},[E,l,C]),[b.current,M.current]}}}]);
