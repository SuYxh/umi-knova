(self.webpackChunk=self.webpackChunk||[]).push([[582],{8434:function(N,X,o){"use strict";o.r(X);var R=o(97857),x=o.n(R),y=o(5574),g=o.n(y),D=o(13769),P=o.n(D),j=o(19632),B=o.n(j),u=o(62435),b=o(79566),w=o(84420),W=o.n(w),e=o(86074),F=["src","stageWidth","stageHeight","rotation","setImgRef","onDimensionsChange"],T="https://qn.huat.xyz/mac/202406051057150.jpeg",G=[{x:10,y:10,width:100,height:100,fill:"red",id:"rect1"},{x:150,y:150,width:100,height:100,fill:"green",id:"rect2"}];function Q(d,t,p){var _=p*Math.PI/180,f=[{x:-d/2,y:-t/2},{x:d/2,y:-t/2},{x:d/2,y:t/2},{x:-d/2,y:t/2}],s=f.map(function(n){return{x:n.x*Math.cos(_)-n.y*Math.sin(_),y:n.x*Math.sin(_)+n.y*Math.cos(_)}}),E=Math.min.apply(Math,B()(s.map(function(n){return n.x}))),c=Math.max.apply(Math,B()(s.map(function(n){return n.x}))),M=Math.min.apply(Math,B()(s.map(function(n){return n.y}))),v=Math.max.apply(Math,B()(s.map(function(n){return n.y}))),r=c-E,h=v-M;return{newWidth:r,newHeight:h}}var V=function(t){var p=t.src,_=t.stageWidth,f=t.stageHeight,s=t.rotation,E=t.setImgRef,c=t.onDimensionsChange,M=P()(t,F),v=W()(p,"anonymous"),r=g()(v,1),h=r[0],n=(0,u.useRef)(null),Y=(0,u.useState)({width:0,height:0,x:0,y:0}),I=g()(Y,2),S=I[0],U=I[1];return(0,u.useEffect)(function(){if(h){var K=Math.min(_,f),$=Math.max(h.width,h.height),L=K/$*.8,O=h.width*L,H=h.height*L;U({width:O,height:H,x:_/2,y:f/2}),c({width:O,height:H,ratio:L})}E(n)},[h,_,f,E]),(0,e.jsx)(b.Ee,x()(x()({ref:n,image:h,rotation:s,offsetX:S.width/2,offsetY:S.height/2},S),M))},Z=function(t){var p=t.shapeProps,_=t.isSelected,f=t.onSelect,s=t.onChange,E=u.useRef(),c=u.useRef();return u.useEffect(function(){_&&(c.current.nodes([E.current]),c.current.getLayer().batchDraw())},[_]),(0,e.jsxs)(u.Fragment,{children:[(0,e.jsx)(b.UL,x()(x()({onClick:f,onTap:f,ref:E},p),{},{draggable:!0,onDragEnd:function(v){s(x()(x()({},p),{},{x:v.target.x(),y:v.target.y()}))},onTransformEnd:function(v){var r=E.current,h=r.scaleX(),n=r.scaleY();r.scaleX(1),r.scaleY(1),s(x()(x()({},p),{},{x:r.x(),y:r.y(),width:Math.max(5,r.width()*h),height:Math.max(r.height()*n)}))}})),_&&(0,e.jsx)(b.$T,{ref:c,flipEnabled:!1,boundBoxFunc:function(v,r){return Math.abs(r.width)<5||Math.abs(r.height)<5?v:r}})]})};function q(){var d={},t=600,p=500,_=(0,u.useState)(0),f=g()(_,2),s=f[0],E=f[1],c=(0,u.useRef)(null),M=(0,u.useRef)(null),v=(0,u.useRef)(null),r=function(a){c.current=a.current},h=function(a){console.log("Updated dimensions:",a),d=a},n=function(a,m,i){var C=document.createElement("canvas");C.width=m,C.height=i;var k=C.getContext("2d");return k.translate(m/2,i/2),k.rotate(s*Math.PI/180),k.drawImage(a,-m/2,-i/2),C.toDataURL()},Y=function(){var a=v.current,m=a.toDataURL(),i=document.createElement("a");i.download="rotated-image.png",i.href=m,document.body.appendChild(i),i.click(),document.body.removeChild(i)},I=function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:1;if(c.current){var m;if(a===3){var i=c.current.attrs.image,C=i.width,k=i.height;console.log("originalWidth",C),console.log("originalHeight",k),m=n(i,C,k)}else if(a===2){console.log("rotationPic",d,s);var ee=c.current.attrs.image,z=Q(d.width,d.height,s);console.log("size",z);var te=z.newWidth*(1+d.ratio),ne=z.newHeight*(1+d.ratio);m=n(ee,te,ne)}else m=c.current.toDataURL();var ae={3:"rotated-original-size-image.png",2:"rotated-original-size-ratio.png",1:"rotated-image.png"},A=document.createElement("a");A.download=ae[a],A.href=m,document.body.appendChild(A),A.click(),document.body.removeChild(A)}},S=u.useState(G),U=g()(S,2),K=U[0],$=U[1],L=u.useState(null),O=g()(L,2),H=O[0],J=O[1],re=function(a){var m=a.target===a.target.getStage();m&&J(null)};return(0,e.jsxs)("div",{style:{width:"600px",height:"auto",border:"1px solid black"},children:[(0,e.jsx)("input",{type:"range",min:"0",max:"360",value:s,onChange:function(a){return E(a.target.value)},style:{marginBottom:"10px"}}),(0,e.jsx)("button",{type:"button",onClick:function(){return Y()},style:{marginBottom:"10px"},children:"\u5BFC\u51FA\u753B\u5E03"}),(0,e.jsx)("button",{type:"button",onClick:function(){return I()},style:{marginBottom:"10px"},children:"\u5BFC\u51FA\u56FE\u7247"}),(0,e.jsx)("button",{type:"button",onClick:function(){return I(3)},style:{marginBottom:"10px"},children:"\u5BFC\u51FA\u539F\u5C3A\u5BF8\u65CB\u8F6C\u56FE"}),(0,e.jsx)("button",{type:"button",onClick:function(){return I(2)},style:{marginBottom:"10px"},children:"\u5BFC\u51FA\u539F\u6BD4\u4F8B\u65CB\u8F6C\u56FE"}),(0,e.jsx)(b.Hf,{ref:M,width:t,height:p,children:(0,e.jsxs)(b.mh,{ref:v,children:[(0,e.jsx)(V,{src:T,stageWidth:t,stageHeight:p,rotation:Number(s),setImgRef:r,onDimensionsChange:h}),K.map(function(l,a){return(0,e.jsx)(Z,{shapeProps:l,isSelected:l.id===H,onSelect:function(){J(l.id)},onChange:function(i){var C=K.slice();C[a]=i,$(C)}},a)})]})})]})}X.default=q},84420:function(N,X,o){var R=o(62435);N.exports=function(y,g,D){const P=R.useRef("loading"),j=R.useRef(),[B,u]=R.useState(0),b=R.useRef(),w=R.useRef(),W=R.useRef();return(b.current!==y||w.current!==g||W.current!==D)&&(P.current="loading",j.current=void 0,b.current=y,w.current=g,W.current=D),R.useLayoutEffect(function(){if(!y)return;var e=document.createElement("img");function F(){P.current="loaded",j.current=e,u(Math.random())}function T(){P.current="failed",j.current=void 0,u(Math.random())}return e.addEventListener("load",F),e.addEventListener("error",T),g&&(e.crossOrigin=g),D&&(e.referrerPolicy=D),e.src=y,function(){e.removeEventListener("load",F),e.removeEventListener("error",T)}},[y,g,D]),[j.current,P.current]}}}]);
